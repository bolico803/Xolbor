<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xolbor - Ultimate Gaming Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%236366f1'/><stop offset='100%' style='stop-color:%23a855f7'/></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23grad)'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-family='Arial Black'>X</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #a855f7;
            --dark: #0f172a;
            --gold: #ffd700;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: white;
            overflow-x: hidden;
        }

        /* Particles Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(99, 102, 241, 0.5);
            border-radius: 50%;
            animation: float 20s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(100px); opacity: 0; }
        }

        /* Auth Page */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .auth-box {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 30px;
            padding: 50px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 30px 100px rgba(99, 102, 241, 0.3);
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            font-weight: 900;
            margin-bottom: 20px;
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .logo-title {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(99, 102, 241, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            margin-top: 15px;
            border: 2px solid rgba(99, 102, 241, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }

        .error {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        /* Main App */
        .main-app {
            display: none;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Navbar */
        .navbar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 25px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 20px;
            transition: all 0.3s;
            background: rgba(99, 102, 241, 0.1);
        }

        .user-profile:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: scale(1.05);
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border: 3px solid var(--gold);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
            position: relative;
        }

        .status-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 15px;
            height: 15px;
            background: #10b981;
            border: 3px solid var(--dark);
            border-radius: 50%;
            animation: pulse-status 2s infinite;
        }

        @keyframes pulse-status {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .search-box {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 50px;
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .xubor-balance {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: var(--dark);
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0%, 100% { box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 10px 40px rgba(255, 215, 0, 0.7); }
        }

        .online-counter {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn {
            padding: 12px 25px;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #ef4444;
            transform: translateY(-2px);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab:hover {
            transform: translateY(-3px);
            background: rgba(99, 102, 241, 0.2);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: transparent;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.5);
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }

        .game-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 25px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
        }

        .game-card:hover::before {
            left: 100%;
        }

        .game-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.4);
        }

        .game-icon {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .game-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .game-players {
            color: #10b981;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Skins Grid */
        .skins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
        }

        .skin-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .skin-card:hover {
            transform: scale(1.05) rotate(2deg);
            border-color: var(--gold);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3);
        }

        .skin-preview {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            margin-bottom: 15px;
        }

        .skin-name {
            font-weight: 700;
            margin-bottom: 10px;
        }

        .skin-price {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: var(--dark);
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: 900;
            display: inline-block;
            margin-bottom: 15px;
        }

        .buy-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.5);
        }

        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Profile */
        .profile-container {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 30px;
            padding: 50px;
            text-align: center;
        }

        .profile-avatar {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 120px;
            border: 5px solid var(--gold);
            box-shadow: 0 30px 80px rgba(99, 102, 241, 0.5);
            animation: float-avatar 4s ease-in-out infinite;
        }

        @keyframes float-avatar {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .profile-name {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .stat-card {
            background: rgba(99, 102, 241, 0.1);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            padding: 30px;
        }

        .stat-value {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            margin-top: 10px;
        }

        /* Xubor Packages */
        .xubor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }

        .xubor-package {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .xubor-package::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1), transparent);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .xubor-package:hover {
            transform: scale(1.08);
            border-color: var(--gold);
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.5);
        }

        .package-amount {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 15px;
        }

        .package-price {
            font-size: 56px;
            font-weight: 900;
            color: var(--gold);
        }

        /* Friends */
        .friends-search {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .friends-search input {
            flex: 1;
        }

        .friend-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
        }

        .friend-card:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .friend-status {
            color: #10b981;
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.5);
            border-radius: 30px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 28px;
            font-weight: 900;
        }

        .close-btn {
            font-size: 36px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.5);
            transition: all 0.3s;
        }

        .close-btn:hover {
            color: white;
            transform: rotate(90deg);
        }

        .payment-summary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .section-title {
                font-size: 28px;
            }

            .profile-avatar {
                width: 150px;
                height: 150px;
                font-size: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Auth Page -->
    <div class="auth-container" id="authPage">
        <div class="auth-box">
            <div class="logo-container">
                <div class="logo">X</div>
                <div class="logo-title">XOLBOR</div>
                <p class="subtitle">üöÄ Ultimate Gaming Platform</p>
                <p class="online-counter" style="display: inline-flex; margin-top: 15px;">
                    üü¢ <span id="onlineCount">0</span> en ligne
                </p>
            </div>

            <!-- Login Form -->
            <div id="loginForm">
                <div class="form-group">
                    <label>üë§ Pseudo</label>
                    <input type="text" id="loginUsername" placeholder="Entrez votre pseudo">
                </div>
                <div class="form-group">
                    <label>üîí Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="Entrez votre mot de passe">
                    <span class="error" id="loginError"></span>
                </div>
                <button class="btn btn-primary" onclick="login()">
                    <span style="position: relative; z-index: 1;">üéÆ SE CONNECTER</span>
                </button>
                <button class="btn btn-secondary" onclick="showRegister()">
                    <span style="position: relative; z-index: 1;">‚ú® CR√âER UN COMPTE</span>
                </button>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <div class="form-group">
                    <label>üë§ Pseudo</label>
                    <input type="text" id="registerUsername" placeholder="Choisissez un pseudo unique">
                </div>
                <div class="form-group">
                    <label>üîí Mot de passe</label>
                    <input type="password" id="registerPassword" placeholder="Choisissez un mot de passe">
                    <span class="error" id="registerError"></span>
                </div>
                <button class="btn btn-primary" onclick="register()">
                    <span style="position: relative; z-index: 1;">‚ú® S'INSCRIRE</span>
                </button>
                <button class="btn btn-secondary" onclick="showLogin()">
                    <span style="position: relative; z-index: 1;">‚óÄ Retour</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="main-app" id="mainApp">
        <div class="container">
            <!-- Navbar -->
            <div class="navbar">
                <div class="user-profile" onclick="showTab('profile')">
                    <div class="avatar" id="navAvatar">
                        üë§
                        <div class="status-dot"></div>
                    </div>
                    <div>
                        <div style="font-weight: 700; font-size: 18px;" id="navUsername">Joueur</div>
                        <div style="font-size: 12px; color: #10b981;">üü¢ En ligne</div>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Rechercher des jeux...">
                    <span class="search-icon">üîç</span>
                </div>

                <div class="xubor-balance">
                    <span style="font-size: 24px;">üíé</span>
                    <span id="xuborDisplay" style="font-size: 20px;">0</span>
                    <span>XUBOR</span>
                </div>

                <div class="online-counter">
                    üü¢ <span id="onlineCountMain">0</span> en ligne
                </div>

                <button class="logout-btn" onclick="logout()">
                    üö™ D√©connexion
                </button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="showTab('home')">
                    üè† ACCUEIL
                </div>
                <div class="tab" onclick="showTab('marketplace')">
                    üõí MARKETPLACE
                </div>
                <div class="tab" onclick="showTab('friends')">
                    üë• AMIS <span id="friendCount">(0)</span>
                </div>
                <div class="tab" onclick="showTab('xubor')">
                    üíé ACHETER XUBOR
                </div>
                <div class="tab" onclick="showTab('profile')">
                    üë§ PROFIL
                </div>
            </div>

            <!-- Home Tab -->
            <div class="content-section active" id="homeTab">
                <h1 class="section-title">üéÆ JEUX MULTIJOUEUR</h1>
                <div class="games-grid" id="gamesGrid"></div>
            </div>

            <!-- Marketplace Tab -->
            <div class="content-section" id="marketplaceTab">
                <h1 class="section-title">üõí MARKETPLACE - SKINS</h1>
                <div class="search-box" style="max-width: 600px; margin-bottom: 40px;">
                    <input type="text" id="skinSearchInput" placeholder="üîç Rechercher des skins...">
                    <span class="search-icon">üîç</span>
                </div>
                <div class="skins-grid" id="skinsGrid"></div>
            </div>

            <!-- Friends Tab -->
            <div class="content-section" id="friendsTab">
                <h1 class="section-title">üë• MES AMIS</h1>
                <div class="friends-search">
                    <input type="text" id="friendSearchInput" placeholder="üîç Rechercher un joueur...">
                    <button class="btn btn-primary" onclick="sendFriendRequest()" style="width: auto; padding: 15px 30px;">
                        <span style="position: relative; z-index: 1;">‚ûï AJOUTER</span>
                    </button>
                </div>

                <!-- Friend Requests -->
                <div id="friendRequestsContainer"></div>

                <!-- Friends List -->
                <div id="friendsList"></div>
            </div>

            <!-- Xubor Tab -->
            <div class="content-section" id="xuborTab">
                <h1 class="section-title">üíé ACHETER DES XUBOR</h1>
                <div class="xubor-grid">
                    <div class="xubor-package" onclick="openPaymentModal(100, 10)">
                        <div class="package-amount">üíé 100 XUBOR</div>
                        <div class="package-price">10‚Ç¨</div>
                    </div>
                    <div class="xubor-package" onclick="openPaymentModal(800, 20)">
                        <div class="package-amount">üíé 800 XUBOR</div>
                        <div class="package-price">20‚Ç¨</div>
                    </div>
                    <div class="xubor-package" onclick="openPaymentModal(12095, 234)">
                        <div class="package-amount">üíé 12,095 XUBOR</div>
                        <div class="package-price">234‚Ç¨</div>
                    </div>
                    <div class="xubor-package" onclick="openPaymentModal(999999, 456)">
                        <div class="package-amount">‚ôæÔ∏è ILLIMIT√â</div>
                        <div class="package-price">456‚Ç¨</div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div class="content-section" id="profileTab">
                <div class="profile-container">
                    <div class="profile-avatar" id="profileAvatar">üë§</div>
                    <h1 class="profile-name" id="profileName">JOUEUR</h1>
                    <div class="xubor-balance" style="display: inline-flex;">
                        <span style="font-size: 24px;">üíé</span>
                        <span id="profileXubor" style="font-size: 20px;">0</span>
                        <span>XUBOR</span>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="statGamesPlayed">0</div>
                            <div class="stat-label">üéÆ Jeux Jou√©s</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statFriends">0</div>
                            <div class="stat-label">üë• Amis</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statSkins">0</div>
                            <div class="stat-label">‚ú® Skins Poss√©d√©s</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí≥ PAIEMENT S√âCURIS√â</h2>
                <span class="close-btn" onclick="closePaymentModal()">√ó</span>
            </div>

            <div class="payment-summary">
                <div style="font-size: 32px; font-weight: 900; margin-bottom: 10px;" id="paymentAmount">üíé 100 XUBOR</div>
                <div style="font-size: 48px; font-weight: 900; color: var(--gold);" id="paymentPrice">10‚Ç¨</div>
            </div>

            <div class="form-group">
                <label>üí≥ Num√©ro de carte</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>üìÖ Date d'expiration</label>
                    <input type="text" id="expiryDate" placeholder="MM/AA" maxlength="5">
                </div>
                <div class="form-group">
                    <label>üîí CVV</label>
                    <input type="text" id="cvv" placeholder="123" maxlength="3">
                </div>
            </div>

            <button class="btn btn-primary" onclick="processPayment()">
                <span style="position: relative; z-index: 1;">‚úÖ CONFIRMER LE PAIEMENT</span>
            </button>
        </div>
    </div>

    <script>
        // Variables globales
        let currentUser = null;
        let userData = null;
        let allOnlineUsers = 0;
        let selectedPackage = null;

        // Donn√©es des jeux
        const games = [
            {id: 1, name: 'Aventure Royale', icon: '‚öîÔ∏è'},
            {id: 2, name: 'Course Turbo', icon: 'üèéÔ∏è'},
            {id: 3, name: 'Puzzle Master', icon: 'üß©'},
            {id: 4, name: 'Football Pro', icon: '‚öΩ'},
            {id: 5, name: 'Space Warriors', icon: 'üöÄ'},
            {id: 6, name: 'Zombie Defense', icon: 'üßü'},
            {id: 7, name: 'Chef Simulator', icon: 'üë®‚Äçüç≥'},
            {id: 8, name: 'Dragon Quest', icon: 'üêâ'},
            {id: 9, name: 'Battle Royale', icon: 'üí•'},
            {id: 10, name: 'Racing Stars', icon: 'üèÅ'},
            {id: 11, name: 'Minecraft 2', icon: '‚õèÔ∏è'},
            {id: 12, name: 'Tower Defense', icon: 'üóº'}
        ];

        // G√©n√©ration des skins
        const skinEmojis = ['üòé', 'ü§ñ', 'üëΩ', 'ü¶∏', 'üßô', 'ü¶π', 'üë®‚ÄçüöÄ', 'üßõ', 'üßú', 'üßö', 'ü¶Ñ', 'üêâ', 'ü¶Å', 'üêØ', 'üêª', 'üêº'];
        const skinNames = ['Cool', 'Robot', 'Alien', 'H√©ros', 'Mage', 'Super', 'Astronaute', 'Vampire', 'Sir√®ne', 'F√©e', 'Licorne', 'Dragon', 'Lion', 'Tigre', 'Ours', 'Panda'];
        const skins = [];

        for (let i = 0; i < 100; i++) {
            const emoji = skinEmojis[i % skinEmojis.length];
            const name = skinNames[i % skinNames.length];
            skins.push({
                id: `skin_${i}`,
                name: `${name} ${Math.floor(i / skinEmojis.length) + 1}`,
                icon: emoji,
                price: Math.floor(Math.random() * 500) + 50
            });
        }

        // G√©n√©ration de particules
        function createParticles() {
            const particles = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particles.appendChild(particle);
            }
        }

        // Initialisation
        window.onload = async function() {
            createParticles();
            await loadSession();
            await updateOnlineCount();
            
            setInterval(async () => {
                if (currentUser) {
                    await updateUserOnlineStatus(true);
                    await updateOnlineCount();
                }
            }, 5000);
        };

        async function loadSession() {
            try {
                const session = await window.storage.get('current_session', false);
                if (session) {
                    currentUser = JSON.parse(session.value);
                    const userResult = await window.storage.get(`user_${currentUser}`, true);
                    if (userResult) {
                        userData = JSON.parse(userResult.value);
                        await showMainApp();
                    }
                }
            } catch (e) {
                console.log('No session');
            }
        }

        async function updateOnlineCount() {
            try {
                const result = await window.storage.list('user_', true);
                if (result && result.keys) {
                    let count = 0;
                    for (const key of result.keys) {
                        try {
                            const userResult = await window.storage.get(key, true);
                            if (userResult) {
                                const user = JSON.parse(userResult.value);
                                if (user.online) count++;
                            }
                        } catch (e) {}
                    }
                    allOnlineUsers = count;
                    document.getElementById('onlineCount').textContent = count;
                    document.getElementById('onlineCountMain').textContent = count;
                }
            } catch (e) {
                console.error('Error updating online count:', e);
            }
        }

        async function updateUserOnlineStatus(online) {
            if (!currentUser) return;
            try {
                userData.online = online;
                userData.lastSeen = Date.now();
                await window.storage.set(`user_${currentUser}`, JSON.stringify(userData), true);
            } catch (e) {
                console.error('Error updating status:', e);
            }
        }

        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        async function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const error = document.getElementById('registerError');

            if (!username || !password) {
                error.textContent = '‚ö†Ô∏è Remplissez tous les champs';
                error.style.display = 'block';
                return;
            }

            if (username.length < 3) {
                error.textContent = '‚ö†Ô∏è Pseudo trop court (min 3 caract√®res)';
                error.style.display = 'block';
                return;
            }

            try {
                const exists = await window.storage.get(`user_${username}`, true);
                if (exists) {
                    error.textContent = '‚ùå Ce pseudo existe d√©j√† !';
                    error.style.display = 'block';
                    return;
                }
            } catch (e) {}

            const newUser = {
                password,
                xubor: 100,
                avatar: 'üë§',
                friends: [],
                skins: [],
                stats: { gamesPlayed: 0 },
                online: false,
                createdAt: Date.now()
            };

            try {
                await window.storage.set(`user_${username}`, JSON.stringify(newUser), true);
                alert('‚úÖ Compte cr√©√© ! 100 Xubor offerts üéâ\n\nConnectez-vous maintenant !');
                showLogin();
                error.style.display = 'none';
            } catch (e) {
                error.textContent = '‚ùå Erreur lors de la cr√©ation';
                error.style.display = 'block';
            }
        }

        async function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const error = document.getElementById('loginError');

            if (!username || !password) {
                error.textContent = '‚ö†Ô∏è Remplissez tous les champs';
                error.style.display = 'block';
                return;
            }

            try {
                const userResult = await window.storage.get(`user_${username}`, true);
                if (!userResult) {
                    error.textContent = '‚ùå Pseudo introuvable';
                    error.style.display = 'block';
                    return;
                }

                const user = JSON.parse(userResult.value);
                if (user.password !== password) {
                    error.textContent = '‚ùå Mot de passe incorrect';
                    error.style.display = 'block';
                    return;
                }

                currentUser = username;
                userData = user;
                await window.storage.set('current_session', JSON.stringify(username), false);
                await updateUserOnlineStatus(true);
                await showMainApp();
            } catch (e) {
                error.textContent = '‚ùå Erreur de connexion';
                error.style.display = 'block';
            }
        }

        async function logout() {
            await updateUserOnlineStatus(false);
            await window.storage.delete('current_session', false);
            location.reload();
        }

        async function showMainApp() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUI();
            loadGames();
            loadSkins();
            await loadFriends();
            await updateOnlineCount();
        }

        function updateUI() {
            document.getElementById('navUsername').textContent = currentUser;
            document.getElementById('navAvatar').innerHTML = `${userData.avatar}<div class="status-dot"></div>`;
            document.getElementById('xuborDisplay').textContent = userData.xubor.toLocaleString();
            document.getElementById('profileName').textContent = currentUser.toUpperCase();
            document.getElementById('profileAvatar').textContent = userData.avatar;
            document.getElementById('profileXubor').textContent = userData.xubor.toLocaleString();
            document.getElementById('statGamesPlayed').textContent = userData.stats.gamesPlayed;
            document.getElementById('statFriends').textContent = userData.friends?.length || 0;
            document.getElementById('statSkins').textContent = userData.skins?.length || 0;
            document.getElementById('friendCount').textContent = `(${userData.friends?.length || 0})`;
        }

        async function saveUserData() {
            try {
                await window.storage.set(`user_${currentUser}`, JSON.stringify(userData), true);
                updateUI();
            } catch (e) {
                console.error('Save error:', e);
            }
        }

        function loadGames() {
            const grid = document.getElementById('gamesGrid');
            grid.innerHTML = '';
            games.forEach(game => {
                const players = Math.floor(Math.random() * allOnlineUsers) + 1;
                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `
                    <div class="game-icon">${game.icon}</div>
                    <div class="game-title">${game.name}</div>
                    <div class="game-players">üü¢ ${players} en ligne</div>
                `;
                card.onclick = async () => {
                    userData.stats.gamesPlayed++;
                    await saveUserData();
                    alert(`üéÆ Lancement de ${game.name}...\n\n${players} joueurs en ligne !`);
                };
                grid.appendChild(card);
            });
        }

        function loadSkins() {
            const grid = document.getElementById('skinsGrid');
            grid.innerHTML = '';
            skins.forEach(skin => {
                const owned = userData.skins?.includes(skin.id);
                const card = document.createElement('div');
                card.className = 'skin-card';
                card.innerHTML = `
                    <div class="skin-preview">${skin.icon}</div>
                    <div class="skin-name">${skin.name}</div>
                    <div class="skin-price">üíé ${skin.price} Xubor</div>
                    <button class="buy-btn" ${owned ? 'disabled' : ''}>
                        ${owned ? '‚úÖ Poss√©d√©' : 'üõí Acheter'}
                    </button>
                `;
                if (!owned) {
                    card.querySelector('.buy-btn').onclick = () => buySkin(skin);
                }
                grid.appendChild(card);
            });
        }

        async function buySkin(skin) {
            if (userData.xubor < skin.price) {
                alert('‚ùå Pas assez de Xubor !\n\nAchetez-en dans l\'onglet Xubor üíé');
                return;
            }

            if (confirm(`Acheter ${skin.name} pour ${skin.price} Xubor ?`)) {
                userData.xubor -= skin.price;
                if (!userData.skins) userData.skins = [];
                userData.skins.push(skin.id);
                userData.avatar = skin.icon;
                await saveUserData();
                loadSkins();
                alert(`‚úÖ ${skin.name} achet√© !\n\nVotre avatar a √©t√© mis √† jour üéâ`);
            }
        }

        async function loadFriends() {
            const container = document.getElementById('friendsList');
            const requestsContainer = document.getElementById('friendRequestsContainer');
            
            // Charger les demandes d'amis
            let requests = [];
            try {
                const result = await window.storage.get(`friend_requests_${currentUser}`, true);
                if (result) requests = JSON.parse(result.value);
            } catch (e) {}

            if (requests.length > 0) {
                requestsContainer.innerHTML = '<h2 style="margin-bottom: 20px; color: var(--gold);">üì¨ Demandes d\'amis</h2>';
                for (const req of requests) {
                    const reqCard = document.createElement('div');
                    reqCard.className = 'friend-card';
                    reqCard.style.background = 'rgba(255, 215, 0, 0.1)';
                    reqCard.style.borderColor = 'var(--gold)';
                    reqCard.innerHTML = `
                        <div class="avatar">üë§</div>
                        <div class="friend-info">
                            <div class="friend-name">${req}</div>
                            <div style="color: var(--gold);">Veut √™tre votre ami</div>
                        </div>
                        <button class="btn btn-primary" style="width: auto; padding: 10px 20px; margin-right: 10px;" onclick="acceptFriend('${req}')">
                            <span style="position: relative; z-index: 1;">‚úÖ Accepter</span>
                        </button>
                        <button class="btn btn-secondary" style="width: auto; padding: 10px 20px;" onclick="rejectFriend('${req}')">
                            <span style="position: relative; z-index: 1;">‚ùå Refuser</span>
                        </button>
                    `;
                    requestsContainer.appendChild(reqCard);
                }
            } else {
                requestsContainer.innerHTML = '';
            }

            // Charger la liste d'amis
            if (!userData.friends || userData.friends.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5); padding: 50px;">Aucun ami. Envoyez des demandes ! üë•</p>';
                return;
            }

            container.innerHTML = '<h2 style="margin: 30px 0 20px;">Mes amis</h2>';
            for (const friendName of userData.friends) {
                try {
                    const friendResult = await window.storage.get(`user_${friendName}`, true);
                    let friendData = {avatar: 'üë§', online: false};
                    if (friendResult) friendData = JSON.parse(friendResult.value);

                    const card = document.createElement('div');
                    card.className = 'friend-card';
                    card.innerHTML = `
                        <div class="avatar">${friendData.avatar}${friendData.online ? '<div class="status-dot"></div>' : ''}</div>
                        <div class="friend-info">
                            <div class="friend-name">${friendName}</div>
                            <div class="friend-status">${friendData.online ? 'üü¢ En ligne' : '‚ö´ Hors ligne'}</div>
                        </div>
                        <button class="btn btn-secondary" style="width: auto; padding: 10px 20px;" onclick="removeFriend('${friendName}')">
                            <span style="position: relative; z-index: 1;">‚ùå Retirer</span>
                        </button>
                    `;
                    container.appendChild(card);
                } catch (e) {}
            }
        }

        async function sendFriendRequest() {
            const friendName = document.getElementById('friendSearchInput').value.trim();
            if (!friendName) {
                alert('‚ùå Entrez un pseudo !');
                return;
            }

            if (friendName === currentUser) {
                alert('‚ùå Vous ne pouvez pas vous ajouter !');
                return;
            }

            try {
                const friendResult = await window.storage.get(`user_${friendName}`, true);
                if (!friendResult) {
                    alert('‚ùå Utilisateur introuvable !');
                    return;
                }

                if (userData.friends?.includes(friendName)) {
                    alert('‚ùå D√©j√† dans votre liste !');
                    return;
                }

                let requests = [];
                try {
                    const result = await window.storage.get(`friend_requests_${friendName}`, true);
                    if (result) requests = JSON.parse(result.value);
                } catch (e) {}

                if (requests.includes(currentUser)) {
                    alert('‚è≥ Demande d√©j√† envoy√©e !');
                    return;
                }

                requests.push(currentUser);
                await window.storage.set(`friend_requests_${friendName}`, JSON.stringify(requests), true);
                alert(`‚úÖ Demande envoy√©e √† ${friendName} !`);
                document.getElementById('friendSearchInput').value = '';
            } catch (e) {
                alert('‚ùå Erreur');
            }
        }

        async function acceptFriend(friendName) {
            if (!userData.friends) userData.friends = [];
            userData.friends.push(friendName);
            await saveUserData();

            // Ajouter r√©ciproquement
            try {
                const friendResult = await window.storage.get(`user_${friendName}`, true);
                if (friendResult) {
                    const friendData = JSON.parse(friendResult.value);
                    if (!friendData.friends) friendData.friends = [];
                    friendData.friends.push(currentUser);
                    await window.storage.set(`user_${friendName}`, JSON.stringify(friendData), true);
                }
            } catch (e) {}

            // Supprimer la demande
            try {
                const result = await window.storage.get(`friend_requests_${currentUser}`, true);
                if (result) {
                    let requests = JSON.parse(result.value);
                    requests = requests.filter(r => r !== friendName);
                    await window.storage.set(`friend_requests_${currentUser}`, JSON.stringify(requests), true);
                }
            } catch (e) {}

            await loadFriends();
            alert(`‚úÖ ${friendName} est maintenant votre ami !`);
        }

        async function rejectFriend(friendName) {
            try {
                const result = await window.storage.get(`friend_requests_${currentUser}`, true);
                if (result) {
                    let requests = JSON.parse(result.value);
                    requests = requests.filter(r => r !== friendName);
                    await window.storage.set(`friend_requests_${currentUser}`, JSON.stringify(requests), true);
                }
            } catch (e) {}
            await loadFriends();
        }

        async function removeFriend(friendName) {
            if (confirm(`Retirer ${friendName} de vos amis ?`)) {
                userData.friends = userData.friends.filter(f => f !== friendName);
                await saveUserData();

                // Retirer r√©ciproquement
                try {
                    const friendResult = await window.storage.get(`user_${friendName}`, true);
                    if (friendResult) {
                        const friendData = JSON.parse(friendResult.value);
                        friendData.friends = (friendData.friends || []).filter(f => f !== currentUser);
                        await window.storage.set(`user_${friendName}`, JSON.stringify(friendData), true);
                    }
                } catch (e) {}

                await loadFriends();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.closest('.tab').classList.add('active');
        }

        function openPaymentModal(amount, price) {
            selectedPackage = {amount, price};
            document.getElementById('paymentAmount').textContent = amount === 999999 ? '‚ôæÔ∏è XUBOR ILLIMIT√â' : `üíé ${amount.toLocaleString()} XUBOR`;
            document.getElementById('paymentPrice').textContent = price + '‚Ç¨';
            document.getElementById('paymentModal').classList.add('active');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            document.getElementById('cardNumber').value = '';
            document.getElementById('expiryDate').value = '';
            document.getElementById('cvv').value = '';
        }

        async function processPayment() {
            const cardNumber = document.getElementById('cardNumber').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;

            if (!cardNumber || !expiryDate || !cvv) {
                alert('‚ùå Remplissez tous les champs !');
                return;
            }

            if (cardNumber.replace(/\s/g, '').length < 13) {
                alert('‚ùå Num√©ro de carte invalide !');
                return;
            }

            if (cvv.length !== 3) {
                alert('‚ùå CVV invalide !');
                return;
            }

            userData.xubor += selectedPackage.amount;
            await saveUserData();
            closePaymentModal();
            alert(`‚úÖ Paiement r√©ussi !\n\n${selectedPackage.amount.toLocaleString()} Xubor ajout√©s üéâ`);
        }

        // Formatage carte
        document.getElementById('cardNumber')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '');
            let formatted = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formatted;
        });

        document.getElementById('expiryDate')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });

        document.getElementById('cvv')?.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        });

        // Recherche
        document.getElementById('searchInput')?.addEventListener('input', function(e) {
            const search = e.target.value.toLowerCase();
            document.querySelectorAll('.game-card').forEach(card => {
                const title = card.querySelector('.game-title').textContent.toLowerCase();
                card.style.display = title.includes(search) ? 'block' : 'none';
            });
        });

        document.getElementById('skinSearchInput')?.addEventListener('input', function(e) {
            const search = e.target.value.toLowerCase();
            document.querySelectorAll('.skin-card').forEach(card => {
                const title = card.querySelector('.skin-name').textContent.toLowerCase();
                card.style.display = title.includes(search) ? 'block' : 'none';
            });
        });

        // D√©connexion automatique lors de la fermeture
        window.addEventListener('beforeunload', async () => {
            if (currentUser) {
                await updateUserOnlineStatus(false);
            }
        });
    </script>
</body>
</html>
